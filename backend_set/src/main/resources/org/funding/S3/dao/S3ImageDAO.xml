<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.funding.S3.dao.S3ImageDAO">

<!--    이미지 저장-->
    <insert id="insertImage" parameterType="org.funding.S3.vo.S3ImageVO">
        INSERT INTO s3_image (image_type, post_id, image_url, created_at)
        VALUES (#{imageType}, #{postId}, #{imageUrl}, #{createdAt})
    </insert>

    <resultMap id="ImageVOMap" type="org.funding.S3.vo.S3ImageVO">
        <constructor>
            <arg column="image_type" javaType="String"/>
            <arg column="post_id" javaType="Long"/>
            <arg column="image_url" javaType="String"/>
            <arg column="created_at" javaType="java.time.LocalDateTime"/>
        </constructor>
    </resultMap>

<!--    이미지 출력-->
    <select id="findImagesByPost" resultMap="ImageVOMap">
        SELECT image_type, post_id, image_url, created_at
        FROM s3_image
        WHERE image_type = #{imageType}
          AND post_id = #{postId}
    </select>

    <!-- 썸네일 이미지 출력 -->
    <select id="findFirstImageByPost" resultMap="ImageVOMap">
        SELECT image_type, post_id, image_url, created_at
        FROM s3_image
        WHERE image_type = #{imageType}
          AND post_id = #{postId}
        ORDER BY created_at ASC
            LIMIT 1
    </select>


<!--    이미지 삭제-->
    <delete id="deleteImagesByPost">
        DELETE FROM s3_image
        WHERE image_type = #{imageType}
          AND post_id = #{postId}
    </delete>



</mapper>
