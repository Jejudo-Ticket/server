<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.funding.project.mapper.ProjectMapper">

    <!-- 여기에 Project 관련 SQL 쿼리를 작성합니다. -->

    <resultMap id="projectResultMap" type="org.funding.project.vo.ProjectVO">
        <id property="projectId" column="project_id"/>
        <result property="title" column="title"/>
        <result property="promotion" column="promotion"/>
        <result property="projectType" column="project_type"/>
        <result property="deadline" column="deadline"/>
        <result property="rejectionReason" column="rejection_reason"/>
        <result property="createAt" column="create_at"/>
        <result property="userId" column="user_id"/>
        <result property="productId" column="product_id"/>

        <discriminator javaType="org.funding.project.vo.enumType.Feed" column="project_type">
            <case value="Finance" resultMap="financeProjectResultMap"/>
            <case value="Donation" resultMap="donationProjectResultMap"/>
            <case value="Challenge" resultMap="challengeProjectResultMap"/>
            <!-- 'Loan' 케이스는 Feed Enum에 추가 후 여기에 매핑 필요 -->
        </discriminator>
    </resultMap>

    <!-- 각 하위 타입에 대한 ResultMap 정의 -->
    <resultMap id="financeProjectResultMap" type="org.funding.project.vo.SavingProjectVO" extends="projectResultMap">
        <!-- SavingProjectVO에만 있는 필드 매핑 -->
        <!-- 예: <result property="savingSpecificField" column="saving_specific_column"/> -->
    </resultMap>

    <resultMap id="donationProjectResultMap" type="org.funding.project.vo.DonationProjectVO" extends="projectResultMap">
        <!-- DonationProjectVO에만 있는 필드 매핑 -->
    </resultMap>

    <resultMap id="challengeProjectResultMap" type="org.funding.project.vo.ChallengeProjectVO" extends="projectResultMap">
        <!-- ChallengeProjectVO에만 있는 필드 매핑 -->
    </resultMap>

    <!-- TODO: LoanProjectVO에 대한 resultMap 추가 필요 -->

    <select id="findAll" resultMap="projectResultMap">
        SELECT
            p.project_id, p.title, p.promotion, p.project_type, p.deadline, p.rejection_reason, p.create_at, p.user_id, p.product_id,
            -- 각 서브타입 테이블의 컬럼들을 여기에 추가해야 합니다.
            -- 예: d.donation_specific_column, c.challenge_specific_column
        FROM
            project p
        LEFT JOIN donation_project d ON p.project_id = d.project_id AND p.project_type = 'Donation'
        LEFT JOIN challenge_project c ON p.project_id = c.project_id AND p.project_type = 'Challenge'
        LEFT JOIN saving_project s ON p.project_id = s.project_id AND p.project_type = 'Finance' -- 'Finance'가 Saving을 의미한다고 가정
        -- LEFT JOIN loan_project l ON p.project_id = l.project_id AND p.project_type = 'Loan'
    </select>

</mapper>
